# Installing Damselfly

[Return to Readme](../README.md)

- [Installing Damselfly](#installing-damselfly)
  - [Docker](#docker)
    - [Docker Command:](#docker-command)
    - [Docker-Compose:](#docker-compose)
  - [Setting up the Desktop Client](#setting-up-the-desktop-client)
    - [Installing the Desktop Client](#installing-the-desktop-client)

## Docker

The easiest way to install Damselfly is via Docker. Mount your photos folder as the /pictures volume, and a config 
folder (in which the database, thumbnails etc will be stored), and you're ready to go.

### Docker Command:
```
docker run \
  --name damselfly \
  --restart unless-stopped \
  -v /volume1/dockerdata/damselfly:/config \
  -v /volume1/photo:/pictures \
  -v /volume1/dockerdata/damselfly/thumbs:/thumbs \
  -p 6363:6363 \
  -d \
  webreaper/damselfly
```

**_Note:_** If you're running on a Synology NAS, and have the Synology indexing/thumbnails enabled, you can specify `-e SYNO_THUMBS=true` which will make Damselfly use the same `@eaDir` folder structure as Synology's indexing system, which means that thumbnails already generated will be used by Damselfly (and Damselfly's thumbnails will be used by Synology Photo Station).

### Docker-Compose: 
```
 damselfly: 
        container_name: damselfly
        image: webreaper/damselfly
        ports:
            - 6363:6363/tcp
        volumes:
            - /volume1/dockerdata/damselfly:/config
            - /volume1/dockerdata/damselfly/thumbs:/thumbs
            - /volume1/photo:/pictures 
        restart: unless-stopped
```

The default port is 6363, so unless you've changed that, once the server is up and running you can go http://ip.address.of.server:6363 to access the Web UI. The /pictures volume is mapped to the root directory of your photographs. 

Note that in order to set up inotify watchers on your folders, you may need to increase the number of inotify instances as follows (where 524288 is any large number that's big enough for one watcher per folder):

```
echo fs.inotify.max_user_instances=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
```

Other options:
`SYNO_THUMBS=True` - Tells Damselfly to use existing Synology thumbnails (which are generated by DSM's indexing process) and to generate new thumbs in the same format.

## Setting up the Desktop Client

The Damselfly Desktop Client gives closer integration between the server and your Mac, Windows or Linux desktop. You can set up a local folder to mirror the 
folder structure of the photos on the server, and then use Damselfly Desktop to bring across images from the server to work on locally. So you might have
the server indexing:

     `/volume1/photos/Christmas 2020'
     `/volume1/photos/Holiday 2021'
     `/volume1/photos/Fred Wedding'

and set up a folder on your Mac:

     `/Users/markotway/Pictures'

To work on images locally, add them to the basket in and click the download/export button. When running the Damselfly Desktop app, a new button will appear:
'Save Locally', which will copy all of the images selected in, say, the Christmas album into a folder `/Users/markotway/Pictures/Christmas 2020`. Once you've 
finished working on the pictures, you can sync them back to the server (a future version of Damselfly will do this for you).

### Installing the Desktop Client

You can download the desktop client from the server 'info' page (the `i` icon in the bottom right of the status bar). Once downloaded, install as appropriate
for your chosen OS (e.g., the Mac version unzips to a `.dmg` file, which you can double-click, and drag/drop the app into the `Applications` folder).

When you first run the desktop app, you'll be presented with the settings screen; input the URL of the server Web UI, and the root folder of where you'd like
photos to sync locally.

<img style="margin: 5px;" src="./DesktopSetup.jpg" alt="Configuring Damselfly Desktop" width="600"/>

Once you've entered the correct details, click `Save` and the Web UI should be displayed. 
